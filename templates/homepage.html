{% extends 'base.html' %}

{% block title %}Wakfu Builds{% endblock %}
{% block content %}
    <div class="container" id="homepage-container">
        <div class="row row mb-3 pt-5 justify-content-evenly" id="main_homepage_row">
            <div class="col-4" id="homepage_search_col">

                <form action="/search_builds" method="get">
                    <div class="row border rounded-top border-bottom-0" id="homepage_search_row">

                        <div class="row mb-3 pt-3" id="homepage_build_info_row">    
                            <div class="col-lg-6 col-md-12 form-floating mb-3">
                                <input type="text" class="form-control" id="build_name" name="build_name">
                                <label for="build_name">Build Name</label>
                            </div>
                            <div class="col-lg-3 col-md-6 form-floating mb-3">
                                <input type="number" class="form-control" id="min_level" name="min_level" value="20" step="15" min="5" max="{{ max_level }}">
                                <label for="min_level">Min Level</label>
                            </div>
                            <div class="col-lg-3 col-md-6 form-floating mb-3">
                                <input type="number" class="form-control" id="max_level" name="max_level" step="15" min="5" max="{{ max_level }}">
                                <label for="max_level">Max Level</label>
                            </div>
                        </div>

                        <div class="row mb-1 pt-1" id="homepage_class_row">
                            <div class="col">
                                <h5>Class:</h5>
                                <div class="btn-toolbar mb-3" role="group" aria-label="Radio toggle buttons for character class">                
                                    {% for char_class in character_classes %}
                                        <input type="checkbox" class="btn-check" name="character_class_id" id="char_class{{ char_class.id }}" value="{{ char_class.id }}" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="char_class{{ char_class.id }}">{{ char_class.name }}</label>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="row mb-1 pt-1" id="homepage_main_role_row">
                                <h5>Main role:</h5>
                                <div class="btn-toolbar mb-3" role="group" aria-label="Checkbox buttons for main role">
                                        <input type="checkbox" class="btn-check" name="main_role" id="damage" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="damage">Damage</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="melee" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="melee">Melee Dmg</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="distance" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="distance">Distance Dmg</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="tank" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="tank">Tank</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="healer" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="healer">Healer</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="shielder" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="shielder">Shielder</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="positioner" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="positioner">Positioner</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="buffer" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="buffer">Buffer</label>
                                        <input type="checkbox" class="btn-check" name="main_role" id="debuffer" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="debuffer">Debuffer</label>
                                </div>
                        </div>

                        <div class="row mb-1 pt-1" id="homepage_content_focus_row">   
                            <h5>Content Focus:</h5>
                            <div class="btn-toolbar mb-3" role="group" aria-label="Radio toggle buttons for content type">
                                    <input type="radio" class="btn-check" name="content_type" id="solo" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="solo">Solo PvM</label>
                                    <input type="radio" class="btn-check" name="content_type" id="group" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="group">Group PvM</label>
                                    <input type="radio" class="btn-check" name="content_type" id="pvp" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="pvp">PvP</label>
                                    <input type="radio" class="btn-check" name="content_type" id="rift" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="rift">Rift</label>
                                    <input type="radio" class="btn-check" name="content_type" id="ub" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="ub">Ultimate Boss</label>
                            </div>
                        </div>    

                        
                        
                        <!-- First 4 will be the "main" stats -->
                        <div class="row mb-3 pt-3" id="homepage_stats_row">    
                            <h5>Stats:</h5>
                            <div class="input-group mb-3 col-auto">
                                <span class="input-group-text bg-secondary border-secondary">AP:</span>
                                <input type="number" class="form-control" name="min_ap" aria-label="Minimum AP" size="4">
                                <span class="input-group-text bg-secondary border-secondary"> - </span>
                                <input type="number" class="form-control" name="max_ap" aria-label="Maximum AP">
                            </div>
                            <div class="input-group mb-3 col-auto">
                                <span class="input-group-text bg-secondary border-secondary">MP:</span>
                                <input type="number" class="form-control" name="min_mp" aria-label="Minimum MP">
                                <span class="input-group-text bg-secondary border-secondary"> - </span>
                                <input type="number" class="form-control" name="max_mp" aria-label="Maximum MP">
                            </div>
                            <div class="input-group mb-3 col-auto">
                                <span class="input-group-text bg-secondary border-secondary">WP:</span>
                                <input type="number" class="form-control" name="min_wp" aria-label="Minimum WP">
                                <span class="input-group-text bg-secondary border-secondary"> - </span>
                                <input type="number" class="form-control" name="max_wp" aria-label="Maximum WP">
                            </div>
                            <div class="input-group mb-3 col-auto">
                                <span class="input-group-text bg-secondary border-secondary">Range:</span>
                                <input type="number" class="form-control" name="min_range" aria-label="Minimum range">
                                <span class="input-group-text bg-secondary border-secondary"> - </span>
                                <input type="number" class="form-control" name="max_range" aria-label="Maximum range">
                            </div>


                            <p class="d-inline-flex gap-1 justify-content-end">
                                <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#advanced_stats" aria-expanded="false" aria-controls="advanced_stats">
                                    Advanced
                                </button>
                            </p>
                            <div class="collapse" id="advanced_stats">
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Total Mastery:</span>
                                    <input type="number" class="form-control" name="min_mastery" aria-label="Minimum mastery">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_mastery" aria-label="Maximum mastery">
                                </div>
                                <div class="btn-toolbar mb-3" role="group" aria-label="Checkbox buttons for masteries to include for total mastery">
                                    <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Selecting multiple elements will only return builds with equal mastery in those elements. Other masteries are addititve.">
                                        ?*
                                    </button>
                                    <input type="checkbox" class="btn-check" name="mastery_element" id="fire_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="fire_mastery">Fire</label>
                                    <input type="checkbox" class="btn-check" name="mastery_element" id="water_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="water_mastery">Water</label>
                                    <input type="checkbox" class="btn-check" name="mastery_elment" id="earth_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="earth_mastery">Earth</label>
                                    <input type="checkbox" class="btn-check" name="mastery_element" id="air_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="air_mastery">Air</label>
                                    <input type="checkbox" class="btn-check" name="mastery_type" id="crit_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="crit_mastery">Crit</label>
                                    <input type="checkbox" class="btn-check" name="mastery_type" id="rear_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="rear_mastery">Rear</label>
                                    <input type="checkbox" class="btn-check" name="mastery_type" id="melee_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="melee_mastery">Melee</label>
                                    <input type="checkbox" class="btn-check" name="mastery_type" id="distance_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="distance_mastery">Distance</label>
                                    <input type="checkbox" class="btn-check" name="mastery_type" id="healing_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="healing_mastery">Healing</label>
                                    <input type="checkbox" class="btn-check" name="mastery_type" id="berserk_mastery" autocomplete="off">
                                    <label class="btn btn-sm btn-outline-primary" for="berserk_mastery">Berserk</label>
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Resistance %:</span>
                                    <input type="number" class="form-control" name="min_res" aria-label="Minimum resistance %">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_res" aria-label="Maximum resistance %">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Damage Inflicted %:</span>
                                    <input type="number" class="form-control" name="min_di" aria-label="Minimum damage inflicted %">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_di" aria-label="Maximum damage inflicted %">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Heals Performed:</span>
                                    <input type="number" class="form-control" name="min_heals_performed" aria-label="Minimum heals performed">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_heals_performed" aria-label="Maximum heals performed">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Critical Hit:</span>
                                    <input type="number" class="form-control" name="min_crit_hit" aria-label="Minimum critical hit">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_crit_hit" aria-label="Maximum critical hit">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Block:</span>
                                    <input type="number" class="form-control" name="min_block" aria-label="Minimum block">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_block" aria-label="Maximum block">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Initiative:</span>
                                    <input type="number" class="form-control" name="min_initiative" aria-label="Minimum initiative">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_initiative" aria-label="Maximum initiative">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Dodge:</span>
                                    <input type="number" class="form-control" name="min_dodge" aria-label="Minimum dodge">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_dodge" aria-label="Maximum dodge">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Lock:</span>
                                    <input type="number" class="form-control" name="min_lock" aria-label="Minimum lock">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_lock" aria-label="Maximum lock">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Control:</span>
                                    <input type="number" class="form-control" name="min_control" aria-label="Minimum control">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_control" aria-label="Maximum control">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Force of Will:</span>
                                    <input type="number" class="form-control" name="min_force_of_will" aria-label="Minimum force of will">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_force_of_will" aria-label="Maximum force of will">
                                </div>
                                <div class="input-group mb-3 col-auto">
                                    <span class="input-group-text bg-secondary border-secondary">Armor:</span>
                                    <input type="number" class="form-control" name="min_armor" aria-label="Minimum armor">
                                    <span class="input-group-text bg-secondary border-secondary"> - </span>
                                    <input type="number" class="form-control" name="max_armor" aria-label="Maximum armor">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row pb-2 pt-2 border rounded-bottom" id="homepage_buttons_row">
                        <!-- <nav class="navbar bg-dark border-top" data-bs-teme="dark">
                            <div class="container-fluid">
                                <div class="d-grid gap-2 d-md-flex justify-content-start">
                                    <button class="btn btn-success" type="submit" formaction="/new_build">New Build</button>
                                </div>
                                <div class="d-grid gap-2 d-md-flex justify-content-end">
                                    <button class="btn btn-primary" type="submit" id="homepage_new_build_button">Search</button>
                                </div>
                            </div>
                        </nav> -->

                        <div class="col-auto me-auto" id="homepage_build_button_col">
                            <button class="btn btn-success" type="submit" formaction="/new_build">New Build</button>
                        </div>
                        <div class="col-auto" id="homepage_submit_button_col">
                            <button class="btn btn-primary" type="submit" id="homepage_submit_button">Search</button>
                        </div>
                    </div>
            
                    
                    <div class="row" id="homepage_reset_row">
                        <button class="btn text-decoration-underline text-primary" type="reset" id="homepage_reset_button">Reset</button>
                    </div>
                </form>
            </div>


            <div class="col-7 border rounded-2" id="homepage_results_col">
                

                <div class="row mb-3 pt-3">
                    <div class="col">
                        <h5>Results: {{ builds | length }}</h5>
                    </div>
                    <div class="col d-inline-flex gap-1 justify-content-end">
                        <button class="btn btn-outline-primary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#show_stats" aria-expanded="false" aria-controls="show_all_result_stats">
                            Show all stats
                        </button>
                    </div>
                </div>
                <div class="row mb-3 pt-3 justify-content-center">
                    {% for build in builds %}
                        <div class="col-11 text-bg-dark border border-secondary rounded-4 mb-3" id="individual_result">
                        
                            <div class="mb-3 mx-1">
                                <div class="row pb-3 mb-3 pt-3 border-bottom border-warning-subtle">
                                    <div class="col">Level: {{ build.level }}</div>
                                    {% if build.character_class %}
                                        <div class="col">Class: {{ build.character_class.name }}</div>
                                    {% else %}
                                        <div class="col">Class: </div>
                                    {% endif %}
                                    <div class="col text-truncate">Name: {{ build.build_name }}</div>
                                </div>
                                <div class="row mb-3 pt-3">
                                    {% for equip in equip_order %}
                                        {% set equipment = build.equipment_set[equip] %}
                                        {% if equipment == None %}
                                            <div class="col-auto border">
                                                {{ (equip | replace("_"," ")) | title }}: Empty
                                            </div>
                                        {% else %}
                                            <div class="col-auto border">
                                                {{ (equip | replace("_"," ")) | title }}: {{ equipment.id }}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div class="row mb-3 pt-3">
                                    {% for stat in main_stats_order %}
                                        {% set stat_name = 'total_' + stat %}
                                        {% if "_" in stat %}
                                            <div class="col text-nowrap">{{ (stat | replace("_"," ")) | title}}: {{ build[stat_name] }}</div>
                                        {% elif stat | length == 2 %}
                                            <div class="col text-nowrap">{{ stat | upper }}: {{ build[stat_name] }}</div>
                                        {% else %}
                                            <div class="col text-nowrap">{{ stat | title }}: {{ build[stat_name] }}</div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                
                                <div class="row mb-3 pt-3 border-top collapse" id="show_stats">
                                    {% for stat in (elemental_mastery_order + elemental_res_order + battle_stat_order + secondary_stat_order) %}

                                        {% set stat_name = 'total_' + stat %}
                                        
                                        <!-- {#{% if stat in ['fire_mastery', 'air_mastery', 'earth_mastery', 'water_mastery'] and "elemental_mastery" in session["build_stats"][build.id] %}
                                            <div class="col">{{ (stat | replace("_"," ")) | title}}: {{session["build_stats"][build.id][stat] + session["build_stats"][build.id]["elemental_mastery"]}}</div>
                                        {% elif stat in ['fire_res', 'air_res', 'earth_res', 'water_res'] and "elemental_res" in session["build_stats"][build.id] %}
                                            <div class="col">{{ (stat | replace("_"," ")) | title}}: {{session["build_stats"][build.id][stat] + session["build_stats"][build.id]["elemental_mastery"]}}</div>#} -->
                                        {% if "_" in stat %}
                                            <div class="col text-nowrap">{{ (stat | replace("_"," ")) | title}}: {{ build[stat_name] }}</div>
                                        {% elif stat | length == 2 %}
                                            <div class="col text-nowrap">{{ stat | upper }}: {{ build[stat_name] }}</div>
                                        {% else %}
                                            <div class="col text-nowrap">{{ stat | title }}: {{ build[stat_name] }}</div>
                                        <!-- {#{% else %}
                                            <div class="col">{{ stat | capitalize }}: {{session["build_stats"][build.id][stat]}}</div>#} -->
                                        {% endif %}
                                        
                                    {% endfor %}
                                </div>
                            </div>
                        
                        </div>
                    {% endfor %}
                </div>
                
            </div>
        </div>

    </div>


{% endblock %}